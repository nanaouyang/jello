<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.api.jello.dao.KeepDao">
	<select id="listKeeps" resultType="com.api.jello.entity.Keep">
		SELECT id, KEEP_TYPE, AMOUNT, REMARK, CREATE_TIME
		FROM T_KEEP
		WHERE IS_DELETE = 0
		ORDER BY CREATE_TIME DESC
		limit 0,50
	</select>

	<select id="getBalance" resultType="java.math.BigDecimal">
SELECT SUM(AMOUNT)
FROM (SELECT -T_KEEP.amount AS AMOUNT
      FROM T_KEEP
      WHERE T_KEEP.KEEP_type = 'KEEP_2'
      UNION ALL
      SELECT T_KEEP.amount AS AMOUNT
      FROM T_KEEP
      WHERE T_KEEP.KEEP_type = 'KEEP_1') AS T
    </select>

	<select id="getOutlay" resultType="com.api.jello.entity.Keep">
		SELECT
			SUM( T_KEEP.AMOUNT ) as value,
			date_format( T_KEEP.CREATE_TIME, '%Y-%m-%d' ) as day
		FROM
			T_KEEP
			WHERE T_KEEP.KEEP_TYPE='KEEP_2'
		GROUP BY
			date_format( T_KEEP.CREATE_TIME, '%Y-%m-%d' )
    </select>

	<select id="getBillTime" resultType="com.api.jello.vo.BillVO">
		SELECT
			SUM( T_KEEP.AMOUNT ) as value,
		<if test="time == 'day'">
			date_format( T_KEEP.CREATE_TIME, '%Y-%m-%d' ) as time,
		</if>
		<if test="time == 'week'">
			date_format( T_KEEP.CREATE_TIME, '%Y-%m-%d' ) as time,
		</if>
		<if test="time == 'month'">
			date_format( T_KEEP.CREATE_TIME, '%Y-%m' ) as time,
		</if>
		<if test="time == 'year'">
			date_format( T_KEEP.CREATE_TIME, '%Y' ) as time,
		</if>
			T_KEEP.KEEP_TYPE
		FROM
			T_KEEP
		<if test="time == 'day'">
			WHERE date_format(T_KEEP.CREATE_TIME,'%Y-%m-%d')=date_format(now(),'%Y-%m-%d')
		</if>
		<if test="time == 'week'">
			WHERE yearweek(date_format(T_KEEP.CREATE_TIME,'%Y-%m-%d'))=yearweek(now())
		</if>
		<if test="time == 'month'">
			WHERE date_format(T_KEEP.CREATE_TIME,'%Y-%m')=date_format(now(),'%Y-%m')
		</if>
		<if test="time == 'year'">
			WHERE date_format(T_KEEP.CREATE_TIME,'%Y')=date_format(now(),'%Y')
		</if>
		GROUP BY
		<if test="time == 'day'">
			date_format( T_KEEP.CREATE_TIME, '%Y-%m-%d' ),
		</if>
		<if test="time == 'week'">
			yearweek( T_KEEP.CREATE_TIME),
		</if>
		<if test="time == 'month'">
			date_format( T_KEEP.CREATE_TIME, '%Y-%m' ),
		</if>
		<if test="time == 'year'">
			date_format( T_KEEP.CREATE_TIME, '%Y' ),
		</if>
			T_KEEP.KEEP_TYPE
    </select>

</mapper>